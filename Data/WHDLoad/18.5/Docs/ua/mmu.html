<html>

<head>
<title>WHDLoad and the MMU</title>
<meta name="DC.Language" content="ua">
<meta http-equiv="content-language" content="ua">
<meta http-equiv="content-type" content="text/html; charset=windows-1251">
<!-і $Id: mmu.html 1.4 2009/02/05 20:38:15 wepl Exp wepl $ -і>
</head>

<body>

<h3>WHDLoad і диспетчер пам'яті (MMU)</h3>

<p>Диспетчер пам'яті (MMU) є в наступних процесорах класів 680xx: 68030, 68040,
  68060. Є також, так звані, EC-версії цих процесорів, в яких MMU відсутній. Наприклад,
  у всіх стандартних комп'ютерах моделі A4000/030 установлений тільки процесор
  68EC030. На акселераторах сторонніх виробників можуть установлюватися різні
  процесори, тому для одержання інформації про конкретний акселератор треба звернутися
  до його документації. Наскільки я знаю, всі моделі 68040/68060, які коли-небудь,
  вбудовувалися в Амігі були повноцінними версіями, які мали робочі MMU (тому
  як burstmode й Zorro III вимагають його для функцій вводу/виводу). Розходження
  між повним центральним процесором і версією EC не можуть бути усунуті на рівні
  програмного забезпечення (принаймні, із прийнятної швидкістю). Тому користувач
  повинен самостійно встановити <a href="#usercontrol">відповідні опції</a> для
  WHDLoad.<br>
Для 68020 існує зовнішній диспетчер пам'яті,
називаний 68851, але в цей час він не
підтримується програмою WHDload.</p>

<h4>Можливості диспетчера пам'яті і його
використання в WHDLoad</h4>

<p>Головна мета диспетчера пам'яті полягає в тому, щоб переводити логічні адреси
  у фізичні. Це потрібно для роботи віртуальної пам'яті й для автономного адресного
  простору (наприклад, у багатозадачному захищеному режимі). Інша можливість полягає
  в тому, щоб указувати такі властивості, як &quot;Supervisor Only &quot;, захист
  від запису й режим кешування для кожної ділянки фізичної пам'яті (WHDLoad використовує
  розмір таблиці у 4096 байт). WHDLoad не використовує переклад логічних адрес
  у фізичні. Але зате використовує MMU для <a href="#mem">захисту пам'яті</a>,
  <a
href="cache.html">роботи з кешем</a> і ще для деяких спеціальних можливостей (<a href="snoop.html">Snooping</a>,
  <a
href="../autodoc.html">resload_Protect *?</a>).</p>

<h4><a name="mem">Захист пам'яті в WHDLoad</a></h4>

<p>При запуску, WHDLoad переглядає пам'ять, будує дерево перекладу адрес, яке
  включає до себе всю доступну пам'ять і відзначає наступні адреси як достовірні
  й доступні: $0... BaseMem (бере інформацію з Slave-модуля), $dff000... $dff200
  (Custom-регістри), $bfd000... $bff000 (Cia-регістри) і пам'ять, яку використовує
  Slave-модуль і сама програма WHDLoad. Якщо в пам'яті виявлений відладчик, то
  пам'ять, використовувана відладчиком, буде також позначена, як доступна. Вся
  інша пам'ять позначається як недоступна, і тому кожне звернення до цієї області
  (читання або запис), ініціює повідомлення про помилку доступу до пам'яті й WHDLoad
  завершить свою роботу з виводом відповідного повідомлення. </p>

<h4><a name="usercontrol">Керування диспетчером пам'яті в
WHDLoad з боку користувача</a></h4>

<p>Існує 3 режими взаємодії WHDLoad з
диспетчером пам'яті.

<ol>
  <li><b>Ignore MMU (ігнорування диспетчера пам'яті)</b>:<br>
    При цьому способі WHDLoad не змінює регістрів диспетчера пам'яті. Це буває
    корисним, якщо є ще якась програма, що також працює &nbsp; у цей момент із
    диспетчером пам'яті (наприклад, така як системний монітор&nbsp;TK) і ви не
    хочете вплинути на функціонування цієї програми. Попередження: оскільки WHDLoad
    самостійно не управляє диспетчером пам'яті, то можливе виникнення деяких проблем.
    Ці проблеми можуть створити крах системи або якось порушити нормальне функціонування
    системи. От список можливих проблем:
    <ul>
      <li>Якщо запущені Enforcer/CyberGuard або подібні програми, то вони заблокують
        або перезавантажать систему, тому що WHDLoad створюватиме серію звернень
        щораз, при відключенні OS. Ці звернення не є помилками, це нормальна реакція
        програми WHDLoad.</li>
      <li>Більшь нові версії <strong>68060.library</strong> (починаючи з версії
        41.1) переадресують пам'ять $0-$1000 (перша сторінка) у швидку (Fast)
        пам'ять, використовуючи диспетчер пам'яті. У режимі &quot;<b>ignore MMU</b>&quot;,
        ця переадресація залишиться недоторканою, якщо установлена програма спробує
        використати цю пам'ять для будь-яких операцій з DMA (наприклад, copperlist
        у цій області пам'яті). Результат буде непередбачений, тому що центральний
        процесор у момент DMA-операцій буде читати/писати у швидку (Fast) пам'ять,
        а реальна Chip-пам'ять буде містити в цей момент випадкові дані</li>
      <li>Якщо робота диспетчера пам'яті залежить від обробника помилок (&quot;Помилка
        Доступу&quot;), то має бути активізована опція <a
        href="opt.html#NoTrapHandler">NoTrapHandler/S</a>, інакше будь-яка виняткова
        ситуація буде оброблена програмою WHDLoad, що у випадку непередбачуваних
        дій, зупинить установлену програму. </li>
      <li>Якщо запущений MMU буде працювати з пам'яттю (exception handler, translation
        tree, ...) усередині базової (BaseMem) пам'яті установленої програми,
        то це може призвести до помилки, тому що BaseMem буде тимчасово змінена
        в момент виконання встановленої програми</li>
      <li>Взагалі, кожна програма, що змінює основні функції системи (використовуючи
        диспетчер пам'яті), може конфліктувати із WHDLoad...</li>
    </ul>
  </li>
  <li><b>Disable MMU (відключення диспетчера пам'яті)</b>:<br>
    Цей спосіб можливий тільки на процесорах 68030.
    Диспетчер пам'яті буде виключений й WHDLoad не зможе
    використати можливості MMU. </li>
  <li><b>Use MMU (використання диспетчера пам'яті)</b>:<br>
    При цьому способі WHDLoad бере повний контроль над MMU і здійснює захист пам'яті
    й керування кешем центрального процесора, як зазначалося вище.</li>
</ol>

<p>Для процесорів 68030 режимом за замовчуванням
є <i>Disable MMU</i>.<br>
Для процесорів 68040/68060 - <i>Use MMU</i>.</p>

<p>Існує два параметри для керування
станом диспетчера пам'яті:<br>
  &nbsp;&nbsp;&nbsp; <a href="opt.html#MMU">MMU/S</a> змушує WHDLoad використати
  режим <i>Use MMU</i> і потрібен на системах із процесором 68030 для включення
  можливостей диспетчера пам'яті.<br>
&nbsp;&nbsp;&nbsp; <a href="opt.html#NoMMU">NoMMU/S</a> відключає
використання MMU програмою WHDLoad (<i>Ignore MMU</i>). </p>

<p align="center"><cite>An Enforcer hit is an Enforcer hit, period.</cite> (Michael Sinz)</p>
</body>
</html>
