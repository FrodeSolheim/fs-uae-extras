<HTML>
<HEAD>
<TITLE>Ovládání CPU Cache</TITLE>
<meta name="DC.Language" content="cz">
<meta http-equiv="content-language" content="cz">
<meta http-equiv="content-type" content="text/html; charset=windows-1250">
<!-- $Id: WHDLoad/Docs/en/cache.html	2007/05/07 09:26:56 -->
</HEAD>
<BODY>
<h3>Pøehled CPU Cache</h3>
(autor pøekladu se omlouvá za hrùznost nìkterıch technickıch slov v èeském znìní)
Aby se zlepšil vıkon, nìkterá CPU z øádu 68k jsou schopna cachovat pøístup
k pamìti.
<br>Cache se vdycky pouívají pøes logické adresy, vèetnì funkèního kódu
pro pøístup. To znamená, e pøístupy v uivatelském módu a supervizoru vytvoøí
odlišné vstupy do Cache (pro více informací vyhledejte dokumentace Motoroly).
<p>Následuje pøehled CPU 68k:
<ul><li>68000
ádná
<li>68010<ul>
<li>Instruction Prefetch
<br>dvouwordovı prefetch, jednowordovı dekódovací register
<li>Loop Mode
<br>vzniká, pokud jednowordová instrukci následuje smyèka DBcc,
která je "zasmyèkována" na pøedchozí instrukci; ádná
další instrukce není prefetchována dokud smyèka neskonèí.
</ul><li>68020<ul>
<li>Instruction Prefetch
<br>jeden longword
<li>Instruction Cache
<br>16 øádek &aacute; 16 bajtù = 256 bajtù
<br>mùe bıt aktivována nebo vypnuta pøes CACR
</ul><li>68030<ul>
<li>Instruction Prefetch
<br>jeden longword
<li>Instruction Cache
<br>16 lines &aacute; 16 byte = 256 byte
<br>mùe bıt aktivována nebo vypnuta pøes CACR
<br>Burst mód pøinutí naèíst celé øádky z cache najednou, pokud to podporuje hardware
<li>Data Cache
<br>16 lines &aacute; 16 byte = 256 byte
<br>mùe bıt aktivována nebo vypnuta pøes CACR
<br>vdy WriteThrough
<br>volitelnı Write Allocation mód, aby donutil zápisové operace v uivatelském/supervizor vstupech hlásit se jako závadné
<br>Burst mód nutí celé øádky z cache naèíst se najednou, pokud to podporuje hardware
</ul><li>68040<ul>
<li>Instruction Prefetch
<br>jeden long word
<li>Instruction Cache
<br>256 lines &aacute; 16 byte = 4096 byte
<br>mùe bıt aktivována pøes CACR
<li>Data Cache
<br>256 lines &aacute; 16 byte = 4096 byte
<br>mùe bıt aktivována pøes CACR
<br>volitelné módy CopyBack/WriteThrough via MMU
</ul><li>68060<ul>
<li>Instruction Prefetch
<br>jeden long word
<li>Instruction Cache
<br>512 lines &aacute; 16 byte = 8192 byte
<br>mùe bıt aktivována, vypnuta nebo redukována na pùl pøes CACR
<li>Branch Cache
<br>mùe bıt aktivována pøes CACR
<br>neovlivòována MMU setupem!
<li>Superscalar Dispatch
<br>mùe bıt aktivována pøes CACR
<li>Data Cache
<br>512 lines &aacute; 16 byte = 8192 byte
<br>mùe bıt aktivována, vypnuta nebo redukována na pùl pøes CACR
<br>volitelné módy CopyBack/WriteThrough pøes MMU
<li>Push Buffer
<br>mùe bıt vypnuta pøes PCR
<li>Store Buffer
<br>mùe bıt aktivována pøes CACR
<br>Stranky nesmi byt NonCachable Serialized (precise)
</ul></ul>
<h4><a name="cache">Cache management ve WHDLoad</a></h4>
První dùleitá vìc je pochopit, e cache na 68030-68060
jsou ovládnány Cache Control registrem (CACR) <b>a</b> MMU!
<br>V CACR budou cache globálnì zapnuty nebo vypnuty. Pouíváním stránkování
MMU (4 KBytes s WHDLoadem) bude urèeno, jak mají pracovat.
<br>Na 68030 mùe bıt pamìová stránka Cacheable nebo NonCacheable. Na
68040/68060 mùe bıt cachable WriteThrough, cachable CopyBack, NonCacheable
(imprecise) nebo NonCachable Serialized (precise).
<h4>Standartní setup cache</h4>
Ve WHDLoad jsou standartnì slave a ExpMem oznaèeny jako cachovatelná
CopyBack. BaseMem oblast je oznaèena jako necachovatelná a datová
a instrukèní cache jsou zapnuty v CACR. Take program v BaseMem oblasti
bìí bez cache, ale WHDLoad, slave a ExpMem vyuívají cache pro nejlepší vıkon.
Pokud WHDLoad nepouívá MMU, nastaví se setup s vypnutımi cache, protoe bez MMU
by nebylo moné nakonfigurovat odlišné nastavení pro odlišné oblasti pamìti
a tím pádem, pokud je nìkterá oblast pamìti oznaèená jako NonCacheable,
musí se vypnout všechny cache.

<br>Jestlie WHDLoad nepouívá MMU, ovládá Cache jenom pøes CACR.
<h4>Programátorská kontrola cache</h4>
Jsou dvì resload funkce na ovládání cache: <A HREF="../autodoc.html#resload_SetCACR">resload_SetCACR</a> a <A
HREF="../autodoc.html#resload_SetCPU">resload_SetCPU</a>. Resload_SetCACR je stará
rutina a <a href="../autodoc.html#resload_SetCPU">resload_SetCPU</a> ji mùe plnì nahradit. (WHDLoad internì mapuje parametry
<a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> a volá <a href="../autodoc.html#resload_SetCPU">resload_SetCPU</a>).
Kazdopádnì, pouití <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> se doporuèuje pro všechny, kdo nic neví
o cache a jejich chování v Amiga systému. Pouíváním <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> mohou bıt
vypnuty nebo zapnuty instrukèní a datové cache. <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> ovlivòuje pouze
cachovatelnost BaseMem pamìti.

<h4>Ovládaní cache uivatelem</h4>
Jestlie programátor odvedl dobrou práci, uivatel se nemusí o cache nijak starat,
protoe všechno zaøídí setup slavu.
<br>Ale mohou se vyskytnout dva dùvody pro zmìnu setupu cache. První je zpojízdnit
instalaèku, která má nìjaké problémy, protoe bìí pøíliš rychle (napø. grafické
chyby) a druhı je urychlit nainstalovanı program.
<p>K lepší funkci problematického programu je tu volba <a href="opt.html#NoCache">NoCache</a>.
Tato volba vypne všechny cache a oznaèí pamìt jako necachovatelnou Serialized.
Pokud má ale stroj 32-bitovou Chip RAM, bude poøád ještì rychlejší ne pùvodnì na A500.

<p>K urychlení programu mùete nastavit volby pro zapínání cache. Ty mají vìtší
prioritu nad setupem slave. Na 68020 mùe bıt pouita volba <a href="opt.html#Cache">Cache</a>.
Pro 68030 je volba <a href="opt.html#DCache">DCache</a>, kterou ale volba Cache zahrnuje
také. Pro 68060 existuje víc voleb: <a href="opt.html#BranchCache">BranchCache</a>,
<a href="opt.html#StoreBuffer">StoreBuffer</a> a <a href="opt.html#SuperScalar">SuperScalar</a>.
Volba <a href="opt.html#ChipNoCache">ChipNoCache/S</a> mùe vylepšit vıkon na 68040 a 68060,
viz níe.

<br>Toto chování se mùe vyzkoušet spuštìním <i>Speed.Slave</i> ve sloce
<tt>src/memory-speed</tt> developerského archívu.

<h4>Burst Mode</h4>
Burst mód na 68030 øíká CPU, aby naèetlo plnou cache øádku (16 bajtù),
pokud se neobjeví poadovanı long word. Burst mód musí bıt podporován
hardwarem, pokud není, Burst se nepøihodí bez èasového postihu.
Burst mód mùe bıt zapnut zvláš pro instrukèní a zvláš pro data cache.
Protoe pøístup k Burst trvá déle ne jednoduchı pøístup, Burst mód
dává vıhodu ve vıkonu jen kdy je vìtšina vstupù v cache øádce pouita
pøedtím ne se cache spláchne. U instrukèní cache Burst mód obvykle
vıkon vylepší, pro data cache èasto jen v pøípadech, kdy se naèítá
z konsekutivní pamìti. WHDLoad zapne instrukèní burst spoleènì s instrukèní
cache od v18.0. Data Burst mód WHDLoad nezapíná.

<h4>Write Allocation</h4>
Write Allocation kontroluje ovladaní cache na 68030, kdy se pøihodí selhaní cache
pøi zápisu. Write Allocation musí bıt zapnuta, kdy èásti nainstalovaného programu bìí
v uivatelském módu. Pokud nainstalovanı program bìí jenou v supervizor módu,
mùe bıt Write Allocation vypnuta, co je minimální vıhoda pro vıkon.

<h4>Branch Cache</h4>
<p>Branch Cache je pouze na 68060. Je to druh instrukèní cache pro branch instrukce.
Ale narozdíl od instrukèní cache není ovlivòovatelná MMu setupem! To znamená,
e i kdy je stránka pamìti oznaèena jako necachovatelná, branch instrukce budou
cachovány, pokud je zapnuta Branch Cache.</p>
<hr>Pøeètìte si Motorola Microprocessors User Manualy pro další informace.
Jestli protestujete nebo chcete nìco dodat, pište mi na <A HREF="mailto:wepl@whdload.de">e-mail</A>.
</BODY>
</HTML>
