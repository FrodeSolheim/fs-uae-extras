<HTML>
<HEAD>
<TITLE>WHDLoad a MMU</TITLE>
<meta name="DC.Language" content="cz">
<meta http-equiv="content-language" content="cz">
<meta http-equiv="content-type" content="text/html; charset=windows-1250">
<!-- $Id: mmu.html 1.6 2014/12/04 23:37:38 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>WHDLoad a Memory Management Unit (MMU)</h3>
MMU je v následujících procesorech 68000 rodiny: MC68030,
MC68040, MC68060. Existují také takzvané EC verze procesoru, které mají
nefunkèní MMU. Napø. všechny standartní A4000/030 mají MC68EC030 CPU.
Na turbokartách se to liší (informujte se v jejich dokumentaci). Pokud vím,
všechny existující 68040/68060 jsou plnohodnotná CPU s funkèním MMU,
protoe Zorro III poaduje mapování MMU celého IO prostoru. Rozdíl mezi plnou
verzí a EC verzí CPU je, e MMU nemùe bıt nahrazeno softwarem. Uivatel tedy
musí <a href="#usercontrol">uivatelskou kontrolu</a> MMU pro WHDLoad nastavit ruènì.
<br>Pro MC68020 je externí MMU MC68851, ale WHDLoad ho v souèasnosti nepodporuje.
<h4>Schopnosti MMU a pouití ve WHDLoad</h4>
Hlavní úèel MMU je pøeloit logické adresy na fyzické. Je to tøeba pro virtuální
pamì a oddìlené adresové prostory. Další schopnost je zadat zvláštní vlastnosti
jako supervisor Only, Write Protected a Caching mod pro kadou fyzickou adresu/místo,
nakonfigurovat na bázi stránkování, kde stránka pouívaná WHDLoadem má velikost 4096 bajtù.
 WHDLoad nepouívá pøeklad logická->fyzická adresa. Ale
pouívá MMU pro <a href="#mem">ochranu pamìti</a>, <a href="cache.html">cache management</a>
a speciální schopnost (<a href="snoop.html">Snooping</a>, <A HREF="../autodoc.html">resload_Protect#?</a>).
<h4><a name="mem">Ochrana pamìti ve WHDLoad</a></h4>
Na zaèátku WHDLoad scanuje list pamìti a vytvoøí translation tree, kterı obsahuje
univerzálnì pøístupnou pamì. Oznaèí následující adresovı prostor jako legální
a pøístupnı: $0...BaseMem (velikost urèena ve slave), $dff000...$dff200 (Custom registry),
$bfd000...$bff000 (Cia registry) a pamì pouitá slavem a WHDLoad. Pokud je v pamìti
nalezen freezer, pamì, kterou pouívá, bude také legální. Všecnha ostatní pamì
je nelegální a kadı pøístup do ní vytvoøí vyjímku Access Fault, která skonèí
pøíslušnım chybovım hlášením WHDLoadu.
<h4><a name="usercontrol">Uivatelova kontrola MMU ve WHDLoad</a></h4>
Jsou tøi odlišné módy, jak WHDLoad ovlivòuje existující MMU.
<ol>
<li><b>ignorovat MMU</b>:<br>
V tomto módu WHDLoad nevytvoøí ádnı MMU registr, to se hodí pro programy,
které nemají opravené chyby a MMU jim nedovoluje pokraèovat v bìhu. Patøí mezi
nì i freezer TK.
<br>
Varování: protoe WHDLoad neovládá MMU sám, mohou se vyskytnout problémy - sekání,
nefunkènost... tady je seznam problemù, o kterıch víme:
<ul>
<li>bìící Enforcer/CyberGuard nebo podobná utilita sekne stroj, protoe WHDLoad
vytvoøí øadu chyb, kdy pøepíná do OS a zpìt. Tyto chyby ale nejsou nedostatky
WHDLoad, ale èást normální operace.
<li>novìjší verze 68060.library (od v41.1) remapují pamì $0-$1000 (první stránka)
do fast RAM lokace pomocí MMU, v "ignorovacím módu" tento pøeklad adres zùstane
nedotèenı. Pokud tuto oblast pouívá nainstalovanı program pro DMA akce - copperlist, atd.
vısledky jsou nevypoèitatelné, protoe CPU zapisuje do Fast RAM, ale data obsahuje
Chip RAM.
<li>jestli bìící MMU pouívá nìjakou pamì (handler vyjímek, translation tree)
uvnitø BaseMem nainstalovaného programu, mùe se seknout, protoe BaseMem bude pøepsána
v bìhu instalovaného programu.
<li>v podstatì kadı program, kterı mìní základní funkce systému pomocí MMU,
mùe s WHDLoad vejít do konfliktu.
</ul>
<li><b>vypnout MMU</b>:<br>
Tento mód je monı jen na 68030. WHDLoad MMU vypne a ádná z jeho MMU moností
nebude k dispozici.
<li><b>pouít MMU</b>:<br>
V tomto modu WHDLoad pøebírá kontrolu nad MMU a umoòuje ochranu pamìti a
cache management jak jsem vysvìtlil níe.
</ol>
Na 68030 je standartnì <i>MMU vypnuto</i>. Na 68040/68060 je zapnuto. Zmìnit se to
dá pomocí <a href="opt.html#MMU">MMU/S</a> (aktivuje MMU, na 68030 musí bıt zapnuta)
<a href="opt.html#NoMMU">NoMMU/S</a> MMU vypne.
</BODY>
</HTML>
