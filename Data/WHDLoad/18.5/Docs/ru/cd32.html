<HTML>
<HEAD>
<TITLE>WHDLoadCD32</TITLE>
<meta name="DC.Language" content="ru">
<meta http-equiv="content-language" content="ru">
<meta http-equiv="content-type" content="text/html; charset=windows-1251">
<!-- $Id: cd32.html 1.4 2014/12/04 23:37:38 wepl Exp wepl $ -->
</HEAD>
<BODY>

<h3>WHDLoadCD32</h3>

WHDLoadCD32 представляет собой специальную версию WHDLoad для запуска на
реальной приставке CD&sup3;&sup2;, специально оптимизированную под эту
платформу. Но учтите, что рассчитана она только на стандартную версию
оборудования CD&sup3;&sup2;. Т.е. WHDLoadCD32 НЕ будет работать на SX-32 или
любой другой машине.

<p>Эта версия имеет следующие отличия по сравнению с обычной WHDLoad:
<ul>

<li>не требует и не использует ключевого файла WHDLoad, так что компакт-диски с
WHDLoadCD32 могут свободно распространяться

<li>поддерживается только процессор 68020, что подразумевает отсутствие поддержки MMU

<li>быстрая память (fast memory) не поддерживается

<li>абсолютно отсутствует поддержка записи, сохранения игр, очков игры и дампов
(coredumps), т.к. CD обычно устройство только для чтения

<li>многие, бесполезные на CD&sup3;&sup2; опции были удалены,
чтобы уменьшить размер исполняемых файлов и размер занимаемой памяти,
см. <a href="opt.html">Использование и опции</a>

<li>следующие resload-функции НЕ реализованы и их использование
приведет к завершению WHDLoad с ошибкой TDREASON_ILLEGALARGS:

<ul>
<li><a href="../autodoc.html#resload_DiskLoadDev">resload_DiskLoadDev</a>
<li><a href="../autodoc.html#resload_ProtectRead">resload_ProtectRead</a>
<li><a href="../autodoc.html#resload_ProtectReadWrite">resload_ProtectReadWrite</a>
<li><a href="../autodoc.html#resload_ProtectWrite">resload_ProtectWrite</a>
<li><a href="../autodoc.html#resload_ProtectRemove">resload_ProtectRemove</a>
<li><a href="../autodoc.html#resload_ProtectSMC">resload_ProtectSMC</a>
</ul>

<li>следующие resload-функции - пустышки, они ничего не делают, но и никогда не
приводят к ошибке:

<ul>
<li><a href="../autodoc.html#resload_SaveFile">resload_SaveFile</a>
<li><a href="../autodoc.html#resload_SaveFileOffset">resload_SaveFileOffset</a>
<li><a href="../autodoc.html#resload_DeleteFile">resload_DeleteFile</a>
<li><a href="../autodoc.html#resload_Log">resload_Log</a>
</ul>

<li>отсутствует поддержка <a href="freezer.html">freezer/monitor</a>

<li>отсутствует внутренняя проверка свободного стекового пространства, как и в
обычном WHDLoad, судя по моим тестам, значение по умолчанию в 4096 байт
достаточно для WHDLoadCD32

</ul>

<h3>Полезные советы для WHDLoad под CD&sup3;&sup2;</h3>

Основная проблема с CD&sup3;&sup2; это ограниченный объем основной памяти. Всего
лишь 2 мегабайта памяти (chip memory). Однако для WHDLoad, требуется как можно
больше памяти особенно для операции предварительной загрузки (Preload).
Убедитесь, что в память не загружено никаких других программ, когда Вы
запускаете и устанавливаете программы, используя WHDLoadCD32.

<ul>

<li>Если программа-установщик предлагает Вам выбор между образами дисков
(diskimages) и файлами (files), используйте файлы, потому, что проще
закешировать много маленьких файлов, чем один-два больших.

<li>Если программа-установщик позволяет сжать файлы, используя ProPack/FImp, то
используйте эту возможность и упакуйте все файлы (RNC1 сжимает лучше). Сжатые
файлы требуют меньше места для Preload и практически не влияют на время
загрузки.

<li>Перед запуском WHDLoadCD32 используйте AllocMemReverse (или любую другую
подобную программу). AllocMemReverse это маленькая программка, включенная в
пакет разработчика WHDLoad. Она патчит exec-функцию AllocMem, чтобы для
выделения памяти всегда использовался атрибут MEM_REVERSE. В результате, память
выделяется из свободного объёма сверху вниз, а не снизу вверх, как обычно. Таким
образом, нижняя облать памяти остается свободной. Делается это потому, что
WHDLoad необходимо, чтобы память начиналась с адреса 0, в начале памяти chipmem.
Вся память, используемая в этом нижнем регионе нуждается в свопе. Для хранения
этих данных, необходим дополнительный объем памяти. Чем больше используется
памяти из нижних областей, тем меньше памяти доступно для установленных программ
и для предварительной загрузки файлов.

<li>Всегда используйте опцию <a href="opt.html#Data">Data</a>. Preload не знает
какие файлы будет загружены установленной программой, так что эта функция
загружает все файлы, которые находит. Чтобы не грузить ненужные файлы, создайте
директорию, содержащую только необходимые файлы. Удалите всякую шнягу типа
#?.info, #?.Slave, ReadMe, Manual, ... а затем, запускайте WHDLoad с параметрами
Slave и Data, типа:<br>

<tt>WHDLoadCD32 :Slaves/XYZ.Slave Data=:Data/XYZ Preload</tt>.<br>
Менять текущую директорию нет необходимости.

<li>НЕ используйте файлы данных, сжатые XPK. Распаковка XPK требует очень много
памяти, т.к. библиотеки XPK тоже должны быть для этого в памяти, а сама по себе
декомпрессия также нуждается в памяти, так что это всё приведет к фрагментации.

</ul>
</BODY>
</HTML>
