<HTML>
<HEAD>
<TITLE>WHDLoad a MMU (Memory Management Unit)</TITLE>
<meta name="DC.Language" content="sk">
<meta http-equiv="content-language" content="sk">
<meta http-equiv="content-type" content="text/html; charset=windows-1250">
<!-- $Id: mmu.html 1.3 2013/11/25 22:13:32 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>WHDLoad a Memory Management Unit (MMU)</h3>
MMU sa nachádza v nasledujúcich
procesoroch rodiny 68k: MC68030, MC68040, MC68060. Existujú tie takzvané EC
verzie procesorov, ktoré majú MMU nefunkèné. Napr. všetky štandartné A4000/030
majú MC68EC030 CPU. Na turbokartách je situácia odlišná (pozrite sa do manuálu
od tıchto kariet). Pokia¾ je mi známe, všetky existujúce 68040/68060 obsahujú
plnohodnotné CPU s funkènım MMU (pretoe burst mód a Zorro 3 vyadujú MMU na
mapovanie IO priestoru). MMU nemôe by nahradené softwarovo. <br>
Preto by uívate¾ mal zvoli <a href="#usercontrol">správne nastavenie</a> ako bude WHDLoad naklada s MMU.
<br> Pre MC68020 existuje externé MMU MC68851, ale WHDLoad ho v súèasnosti nepodporuje.

<h4>Schopnosti MMU a ich pouite vo WHDLoad</h4>
Hlavnım úèelom MMU je preloi logické adresy na
fyzické. Je to potrebné kvôli virtuálnej pamäti a oddelenım adresnım priestorom
(napr. v chránenom multi-procesovom systéme). Ïalšou schopnosou je
nastavenie špeciálneho reimu ako Supervisor Only, Write Protected a Caching
mód pre kadı fyzickı adresnı priestor (BasePage, kde stránka pouitá vo
WHDLoad má ve¾kos 4096 bajtov). WHDLoad nepouíva preklad typu
logická-&gt;fyzická adresa. Pouíva však MMU na <a href="#mem">ochranu pamäti</a>,
<a href="cache.html">cache management</a> a niektoré špeciálne schopnosti (<a
href="snoop.html">Snooping</a>, <a href="../autodoc.html">resload_Protect#?</a>).

<a name="mem"><h4>Ochrana pamäte vo WHDLoad</h4></a>
WHDLoad po spustení preh¾adá list pamäte a
vytvorí prekladovú štruktúru (translation tree), ktorá obsahuje prístupnú
pamä. Oznaèí nasledujúce adresné priestory ako platné a prístupné:
$0...BaseMem (pouitím informácie zo Slave), $dff000...$dff200 (Custom
registre), $bfd000...$bff000 (Cia registre) a pamä pouitá programom WHDLoad a
Slave. Ak je v pamäti nájdenı freezer, pamä, ktorú pouíva, bude tie oznaèená
ako platná. Ostatná pamä je oznaèená ako neplatná a kadı prístup do takej
oblasti (èi u èítanie alebo zapisovanie) vytvorí vınimku Access Fault, ktorá
skonèí príslušnım chybovım hlásením programu WHDLoad.

<a name="usercontrol"><h4>Uívate¾ská kontrola práce MMU vo WHDLoad</h4></a>
Existujú 3 rozlièné spôsoby ako WHDLoad ovplyvòuje MMU.
<ol>
<li><b>ignorovanie MMU</b>:<br>
V tomto móde WHDLoad nemení iadny register spojenı s MMU. To sa hodí
     pre programy, ktoré sú v konflikte s MMU a uívate¾ chce, aby
     funkènos takıch programov zostala zachovaná. Patrí medzi ne i freezer TK.
     <br>
     Varovanie: pretoe WHDLoad neovláda MMU sám, môu sa vyskytnú mnostvo
     problémov - mrznutie, zlyhanie, neoèakávane správanie... tu je zoznam
     známych problémov:
<ul>
<li>beiaci Enforcer/CyberGuard alebo podobnı
      program zamrzne stroj, pretoe WHDLoad vytvorí mnostvo Hits vdy, keï
      prepína do OS a spä. Tieto chyby ale nie sú nedostatky WHDLoad, ale sú
      súèasou normálnej operácie.
<li>novšie verzie 68060.library (od v41.1)
      remapujú pamä $0-$1000 (prvá stránka) do Fast RAM pomocou MMU,  pri
      ignorovaní MMU tento preklad adries zostane nedotknutı. Ak túto oblas
      pouíva nainštalovanı program pre DMA akcie - copperlist, atd. následky
      sú nevypoèitate¾né, pretoe CPU èíta/zapisuje Fast RAM oblasti, kım DMA
      pouíva reálnu Chip RAM, ktorá obsahuje náhodné dáta.
<li>ak beiace MMU závisí na ovládaèi vınimiek
      (&quot;Access Fault&quot; vınimka), vo¾ba <a href="opt.html#NoTrapHandler">NoTrapHandler/S</a>
      musí by zapnutá, inak akáko¾vek vınimka bude spracovaná programom
      WHDLoad, ktorı ukonèí nainštalovanı program v prípade nechcenıch chıb.
<li>ak beiace MMU pouíva akúko¾vek pamä
      (ovládaè vınimiek, translation tree...) vo vnútri BaseMem nainštalovaného
      programu, môe zamrznú, pretoe BaseMem bude prepísaná poèas behu
      nainštalovaného programu (doèasne).
<li>v podstate kadı program, ktorı mení
      základné funkcie systému pomocou MMU, môe vojs do konfliktu
      s programom WHDLoad.
</ul>
<li><b>vypnutie MMU</b>:<br>
Tento mód je monı len na 68030. WHDLoad MMU vypne a iadna z jeho MMU moností nebude k dispozícii.
<li><b>pouitie MMU</b>:<br>
V tomto móde WHDLoad preberá plnú kontrolu nad MMU a umoòuje tak ochranu pamäte a cache management tak, ako bolo vysvetlené vyššie.
</ol>
Na 68030 je MMU štandartne<i> </i>vypnuté. Na
68040/68060 je zapnuté. Sú dve vo¾by, ktoré menia toto nastavenie. Vo¾ba <a
href="opt.html#MMU">MMU/S</a> prikáe programu WHDLoad, aby pouil MMU. Táto
vo¾ba vyadovaná na 68030 systémoch. Vo¾ba <a href="opt.html#NoMMU">NoMMU/S</a>
vypne pouitie MMU programom WHDLoad (MMU bude ignorované).
<p><center><cite>An Enforcer hit is an Enforcer hit, period. (Michael Sinz)</center>
</BODY>
</HTML>
