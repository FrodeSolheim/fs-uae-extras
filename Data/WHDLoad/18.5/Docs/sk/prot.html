<HTML>
<HEAD>
<TITLE>Pouívanie resload_Protect#?</TITLE>
<meta name="DC.Language" content="sk">
<meta http-equiv="content-language" content="sk">
<meta http-equiv="content-type" content="text/html; charset=windows-1250">
<!-- $Id: prot.html 1.2 2009/02/05 20:38:15 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>Pouívanie resload_Protect#?</h3>
<h4>Teória</h4>
Existujú rôzne situácie, v ktorıch sa môe
hodi informovanos o prístupoch nainštalovaného programu do urèitıch oblastí
pamäti. S pomocou funkcie <a href="../autodoc.html">resload_Protect#?</a>
je moné chráni urèité oblasti pamäte pred èítaním alebo zapisovaním
procesorom. Ochrana znamená, e kadı prístup do tatko chránenej oblasti vyvolá
Access Fault vınimku, ktorá vyústi v chybové hlásenie programu WHDLoad. Ak
oznaèíte oblas pamäte ako chránenú pouitím funkcie <a
href="../autodoc.html">resload_Protect#?</a>, WHDLoad zmení popisy
danej oblasti v translation tree MMU. Potom pri kadom prístupe do danej
pamäte, CPU vytvorí vınimku Access Fault. Ovládaè vınimiek vo vnútri WHDLoad overí
dôvod pre vınimku. Ak bola príèina v prístupe do chránenej <a
href="../en/mmu.html">stránky</a>,ale prístup sa nezhoduje s chránenou
oblasou, potom bude tento prístup emulovanı a program bude pokraèova
v normálnom chode. Inak sa WHDLoad ukonèí s adekvátnym chybovım
hlásením, alebo inımi slovami funkcie <a href="../autodoc.html">resload_Protect#?</a>
Ovplyvnia len èítanie a zapisovanie dát. Fakt, e kadı prístup do
chránenej stránky (ve¾kos stránky je momentálne $1000) vytvorí zlyhanie prístupu,
i keï chránená oblas má len dåku 1 byte, vyústi do silného spomalenia
chodu programu, hlavne ak sú chránené èasti kódu v rovnakej stránke pamäti. Ak
je program závislı na urèitej rıchlosti, odchılky vo funkènosti nie sú
vylúèené, èo znamená, e niektoré programy nemusia s ochranou pamäte fungova.

<h4>Príklad: checksum kódu</h4>
Ak inštalujete hru pomocou WHDLoad, budete
musie upravi pôvodnı loader v hre tak, aby sa dáta programu nahrávali cez
WHDLoad. Niektoré hry kontrolujú súèet k¾úèovıch oblastí svojho kódu a tım
zisujú, èi kód nebol zmenenı. Niekedy sa však tieto rutiny ako h¾adajú.
Pouitím funkcií <a href="../autodoc.html">resload_Protect#?</a> vo
WHDLoad však problém rieši. Všetko, èo musíte urobi, je chráni zmenené bajty
pred preèítaním. Potom kadá rutina, ktorá sa pokúša vypoèíta checksum a
preèíta váš opravenı kód, spôsobí prístupovú chybu a vy tak zistíte, kde je
kontrolná rutina lokalizovaná.

<h4>Obmedzenie</h4>
Nesmiete chráni stránku pamäe, na ktorú
odkazuje SSP. Ak to spravíte a objaví sa vınimka, dôjde k dvojitej chybe na
zbernici, pretoe CPU nebude schopné zapísa stackframe vınimky. Potom sa dá
program u len resetova. WHDLoad overuje, èi existuje konflikt chránenej
oblasti s SSP a ak áno, ukonèí sa. To ale nepomôe, ak sa SSP zmení neskôr.
<ul>
<li>68020 + 68851
<ul>
<li>tento hardvér nie je momentálne podporovanı
</ul>
<li>68030
<ul>
<li>3-Byte presuny nie sú podporované a
      spôsobia Access Fault, také presuny sa stávajú, ak sa k longword
      pristupuje na nepárnej adrese (napr. tst.l $fff), zatia¾ èo chránená
      oblas pamäte zaèína na $1000). Pretoe toto je nesprávne na 68000, mono
      na to nikdy nenarazíte.
<li>uzamknuté presuny spôsobené TAS, CAS or
      CAS2 nie sú podporované a spôsobia reálnu Access Fault, to ale nie
      je problém, pretoe tieto presuny nie sú podporované hardvérom Amigy.
</ul>
<li>68040
<ul>
<li>tento hardvér nie je momentálne podporovanı
</ul>
<li>68060
<ul>
<li>misaligned data stream prístupy nie sú
      podporované a spôsobia Access Fault, misaligned access je takı prístup
      ktorı sa vzahuje na dve stránky (a jedna z nich je chránená), napr.
      “tst.l ($ffe)” ovplyvòuje stránku $0..$fff a stránku $1000..$1fff,
      toto obmedzenie je skutoènı problém a obèas je kvôli tomu schopnos
      resload_Protect takmer nepouite¾ná, mono to neskôr opravím, ale je to
      aké
<li>misaligned instructions stream prístupy nie
      sú podporované a vytvoria Access Fault, ak sú obe stránky chránené, vo
      väèšine prípadov sa takej situácii dá vyhnú
<li>uzamknuté presuny spôsobené TAS alebo CAS
      nie sú podporované a vytvoria skutoènı Access Fault, to ale nie je
      problém, pretoe tieto presuny nie sú podporované hardvérom Amigy.
<li>inštrukcie, ktoré leia v chránenej stránke
      (a preto musia by emulované) a pristupujú k Supervisor èasti status
      registra, budú vykonané nesprávne, tieto inštrukcie vdy vidia trace bit
      ako 1 a masku priority vınimky ako 7, akáko¾vek modifikácia Supervisor
      èasti bude neúèinná (Supervisor èas zostane nezmenaná).
<li><code>movem</code> inštrukcie môu pristupova k
      chránenej oblasti bez vytvorenia Access Fault. To je moné vïaka tomu, e
      je overovanı len prvı prístup k chránenej oblasti (word alebo longword)
<li><code>move16</code> a double precision operácie (FPU)
      nie sú podporované a vytvora Access Fault
<li>&quot;move (mem),(mem)&quot; s
      prekraèujúcimi zdrojovımi a cie¾ovımi adresami generujú Access
      Fault, pretoe misaligment bude vykonanı nesprávne.
Napríklad: "<code>move.l ($ffc),($ffe)</code>" kde je stránka $1000..$1fff chránená, a pamä pred spustením
obsahuje ($ffc)=$11112222, ($1000)=$33334444, po spustení $1000 bude obsahova $11114444 a nie $22224444
</ul>
</ul>
</BODY>
</HTML>
