<HTML>
<HEAD>
<TITLE>WHDLoad és az MMU</TITLE>
<meta name="DC.Language" content="hu">
<meta http-equiv="content-language" content="hu">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2">
<!-- $Id: mmu.html 1.5 2013/11/25 22:13:32 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>WHDLoad és a Memory Management Unit (MMU)</h3>
MMU a következõ processzorokban található: 68030, 68040, 68060. Ezeknek van egy
úgynevezett EC verziójuk, amiben egy nem mûködõ MMU van. Például minden
standard A4000/030-ben csak egy 68EC030 CPU van. Ez más processzorkártyáknál
változhat, nézd meg a dokumentációjukat. Én úgy tudom, hogy az összes Amigába
épített 68040/68060 teljes CPU, ami tartalmaz egy mûködõ MMU-t (mivel a burstmode
és a Zorro III igényli az IO terület MMU vezérlését). A különbségtétel a teljes
és az EC verzió között szoftveres úton nem oldható meg (legalábbis elfogadható
idõn belül). Ezért ezt a felhasználónak kell megtennie <a
href="#usercontrol">megfelelõ opciók</a> alkalmazásával.
<br>A 68020-as részére van egy külsõ MMU, a 68851, de ezt a WHDLoad jelenleg
nem támogatja.
<h4>Az MMU jellemzõi és használata a WHDLoad-ban</h4>
Az MMU fõ feladata a logikai címek lefordítása fizikai címekre. Ez szükséges a
virtuális emóriához és a különválasztott címzésterekhez (például egy védett
többfeladatos rendszerben). Másik jellemzõje, hogy olyan speciális
tulajdonságokat, mint a Supervisor Only, Write Protected és Cache módok, tud
beállitani minden fizikai címterülethez (laponként, ahol a  WHDLoad egy 4096 byte
méretû lapot használ). A WHDLoad nem használ logikaiból fizikai címre fordítást.
De használja az MMU-t <a href="#mem">memóriavédelemhez</a>, <a
href="cache.html">cache kezeléshez</a> és néhány speciális lehetõséghez: (<a
href="snoop.html">Figyelés</a>, <A
HREF="../autodoc.html">resload_Protect#?</a>).
<h4><a name="mem">Memóriavédelem a WHDLoad-ban</a></h4>
Indításnál a WHDLoad átnézi a memórialistát és felépíti a fordítási fát, amely
az összes elérhetõ memóriát tartalmazza. Elérhetõnek jelöli ki a következõ
címterületeket: $0...BaseMem (a Slave információi alapján),
$dff000...$dff200 (Saját regiszterek), $bfd000...$bff000 (Cia regiszterek) és
a Slave és a WHDLoad á;ltal használt memóriát. Ha a Leállító megtalálható a
memóriában, az általa használt memória is érvényesnek lesz beállítva. Minden
más memória érvénytelennek lesz jelölve, és a hozzáférés (Olvasás vagy Írás)
ezekhez a területekhez Access Fault Exception hoz létre, ami a WHDLoad által
generált hibakérdezõben jelenik meg.
<h4><a name="usercontrol">Az MMU kezelés felhasználói beállítása a WHDLoad-ben</a></h4>
3 különbözõ módon hat a WHDLoad a meglévõ MMU-ra.
<ol>
<li><b>MMU mellõzése</b>:<br>
Ebben a módban a WHDLoad nem változtat meg egy MMU-hoz kötõdõ regisztert sem.
Ez hasznos lehet, ha egy olyan programot használsz, amely használja az MMU-t és
meg akarod õrizni a program funkcióit (például ilyen a szoftveres leállító TK).
<br>
Figyelem: mivel a  WHDLoad nem maga vezérli az MMU-t, sok hiba elõfordulhat.
Ezek a problémák összeomlásokat, hibás mûködést vagy egyéb nem belátható
következményeket okozhatnak. Itt a létezõ veszélyek listája:
<ul>
<li>Enforcer/CyberGuard vagy hasonló program futtatása leállíthatja a gépet,
mivel a WHDLoad nagyon sok jelzést generál amikor ki/bekapcsolja a rendszert.
Ezek nem hibák, hanem a normális mûködés részei.
<li>68060.library új verziói (v41.1-el kezdõdõen) átrakják a $0-$1000 memóriát
(az elsõ lapot) a Fast memóriába az MMU segítségével, "MMU mellõzése" módban ez
a címfordítás érvényes marad, és ha az installált program bármilyen DMA
mûveletet (pl. egy copperlistát ezen a területen) hajt végre, az eredmény nem
lesz elõrelátható, mivel a CPU egy Fast memóriahelyet fog olvasni mialatt a DMA
valódi Chip memóriája véletlenszerû adatokat fog tartalmazani.
<li>ha a futó MMU a kivét kezelõjétõl függ ("Access Fault" kivét), akkor
a <a href="opt.html#NoTrapHandler">NoTrapHandler/S</a> opciót be kell
kapcsolni, egyébként minden kivétet a WHDLoad fog kezelni, ami kilép minden nem
várt dolog esetén
<li>ha az MMU valamilyen memóriát (kivét kezelõ, fordítási fa, ...) használ az
installált program BaseMem területén, össze fog omlani, mivel a BaseMem felül
lesz írva az installált program végrehajtása során (ideiglenesen)
<li>általánosságban minden olyan program amely a rendszer alapvetõ funkcióit
változtatja meg (az MMU-t használva), összeakadhat a WHDLoad-dal ...
</ul>
<li><b>MMU kikapcsolva</b>:<br>
Ebben a módban, amely 68030-ason lehetséges, az MMU ki lesz kapcsolva, az MMU
specifikus lehetõségek sem érhetõek el.
<li><b>MMU használata</b>:<br>
Ebben a módban a WHDLoad átveszi a teljes irányítást az MMU felett és beállítja
a memoriavédelmet és a cache kezelést a fent leírtak alapján.
</ol>
68030on az alapértelmezett mód az <i>MMU kikapcsolva</i>. 68040/68060-on az
alapértelmezett az <i>MMU használatban</i>. Két opció vezérli ezt a visekedést.
<a href="opt.html#MMU">MMU/S</a> kötelezi a WHDLoad-ot az <i>MMU használatára</i>
és 68030-as rendszereken ez szükséges az MMU lehetõségek használatához.
<a href="opt.html#NoMMU">NoMMU/S</a> kikapcsolja az MMU használatát: a WHDLoad
(<i>mellõzi az MMU-t</i>).
<center><p><cite>Egy Enforcer hit az egy Enforcer hit, pont.</cite> (Michael Sinz)</p></center>
</BODY>
</HTML>
