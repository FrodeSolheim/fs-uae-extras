<HTML>
<HEAD>
<TITLE>Figyelés</TITLE>
<meta name="DC.Language" content="hu">
<meta http-equiv="content-language" content="hu">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2">
<!-- $Id: snoop.html 1.3 2004/04/07 20:04:58 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>Figyelés</h3>
<h4>Mi ez</h4>
A figyelés a WHDLoad olyan funkciója, ami az egyéni és a Cia regiszterek
ellenõrzését és hozzáférések naplózását végzi. Ha a <a href="opt.html#Snoop">Snoop</a>
aktiválva van, minden hibás hozzáférés egy hozzáférési hibát fog létrehozni és
az installált program be lesz fejezve. Az ilyen hozzáférések:
<ul>
<li>nemlétezõ regiszterekhez való hozzáférés
<li>olvasási hozzáférés a csak írható regiszterekhez
<li>írási hozzáférés a csak olvasható regiszterekhez
<li>hozzáférések a kori olvasású regiszterekhez
<li>byte írási hozzáférések (kivévé <tt>bltcon0l</tt> és <tt>aud*vol+1</tt>)
</ul>
A strobe regiszterek olvashatók vagy írhatók. Az érvényes egyéni regiszterek
csoportja változik az OCS (Old ChipSet - A500, A1000, régi A2000), ECS (Enhanced ChipSet
- A600, új A2000, A3000) és AGA (Advanced Graphics - A1200, A4000) gépeken. Ez
hasznos lehet olyan hibák felderítéséhez, amelyeket régi programok okozhatnak
az új AGA regiszterekhez való hozzáférésnél.
<h4>Hogyan mûködik</h4>
Ha a Snoop be van kapcsolva, a WHDLoad az egyéni és a Cia regisztereket
érvénytelennek jelöli az MMU fordítási fában. Emiatt minden hozzáférés ezekhez
a regiszterekhez hozzáférési hiba kivétet eredményez. A WHDLoad saját kivét
kezelõje fogja ezt kezelni. Elõször ellenõrzi, hogy a hozzáférés érvényes-e. Ha
a hozzáférés érvénytelen, a program be lesz fejezve. Ha a hozzáférés érvényes
és ha egy olvasási utasítás, akkor az emulálva lesz, és a program végrehajtása
folytatódik. Ha ez egy írási utasítás, a WHDLoad még el is menti az értékeket
egy belsõ tárolóba.
<br>A kivét adminisztrációja miatt és az emuláció miatt a program végrehajtása
lelassulhat. Hogy mennyire, az függ a CPU típusától, a Chip memória típusától (16/32-bit)
és veremmutató állásától ha a Chip memória 32 bites (LongWord vagy nem).
Továbbá függ a hozzáférés típusától (Byte/Word/LongWord, olvasás/írás).
68030-on az írás gyorsabb mint az olvasás (mivel olvasásnál a stackframe 92
byte, írásnál 32 byte), 68060-on az olvasás gyorsabb, mivel az írás emulálása
eléggé összetett.
<h4>Gyors figyelési mód</h4>
A <a href="opt.html#Snoop">Snoop/S</a> opció bekapcsolja a gyors figyelést. Az
olvasási hozzáférés nem lesz ellenõrizve. Nem lesznek speciális ellenõrzések
végrehajtva. Ez a mód hasznos lehet az egyéni regiszterek tartalmának
megszerzéséhez, pl. képek kimentéséhez az <a href="sp.html">SP</a> segítségével.
<h4>Copper lista átnézõ</h4>
A WHDLoad 13-as verziója óta a copperlisták is ellenõrzésre kerülnek. A figyelõ
akor lesz aktiválva, ha írás történik a <tt>coplc</tt> regiszterekhez, ha a copper
dma engedélyezve van, vagy egy installált program aktiválja a copper dma-t
a <tt>dmacon</tt> regiszter írásával. A figyelõ követi a copperlistát és
ellenõrzi az összes Move utasítást a Snoop opció korlátozásainak
alkalmazásával (OCS/ECS/AGA). A Skip és Wait (kivéve CEND) utasítások mellõzve
lesznek. ha egy érvénytelen bejegyzést talál, az installált program kilép. A
figyelõ a (<tt>copjmp</tt>) ágakat követi, érzékeli a hurkokat és 16 allistában
ellenõriz. A Move-ok a copperlistában egy belsõ egyéni regiszter fájlba lesz
írva, amely kiírásra kerül a WHDLoad kilépésénél. A figyelõ nem aktív a gyors
figyelési módban.
<h4>Blitter prioritás ellenõrzése</h4>
Amikor a ChkBltHog/S opció aktiválva van, a WHDLoad ellenõrizni fogja hogy az
installált program bekapcsolja-e a <tt>BltHog</tt> bitet a <tt>dmacon</tt>
regiszterbe írással.
A Blitter prioritás problémákat okozhat néhány hardver konfiguráción nagy
blitter mûveletek alatt (összes csatorna használata esetén).
<h4>Blitter méret ellenõrzes</h4>
Amikor ChkBltSize/S opció aktiválva van, a WHDLoad ellenõrizni fogja, hogy a blitter
nem fér-e hozzá bármilyen memóriához a BaseMem területen kívül.
Írási hozzáféréseknél a <tt>bltsize</tt> vagy a <tt>bltsizh</tt> ellenõrzi,
hogy a soros mód be van-e kapcsolva a <tt>bltcon1</tt> regiszterben. Ha a soros
mód aktiválva van, megszakítja a méretellenõrzést.
Egyébként a WHDLoad kiszámolja az elsõ és az utolsó word-öt minden egyes aktív DMA
csatorna hozzáféréséhez. Ha egy cím kívül van a BaseMem területén, a program
ki fog lépni egy kérdezõvel. A számolás úgy van tervezve, hogy mûködjön minden
módban (növekvõ/csökkenõ, pozitív/negatív modulo, páratlan modulo/mutatók).
<br>Jegyezd meg, hogy a sor rajzolási módja nem lesz ellenõrizve és az összes blitter
regiszter írható a copper által ha a <tt>copcon</tt> be van állítva.
<h4>Blitter várakozás ellenõrzés</h4>
Ha a ChkBltWait/S opció aktiválva van, a WHDLoad az utasítás nyomkövetést fogja
használni annak ellenõrzésére, hogy az installált program rendesen vár-e a
blitterre az új blitter mûvelet megkezdése elõtt. Egy belsõ változót használ,
ami a blitter állapotát jelzi. A változó akkor lesz beállitva, amikor írási
hozzáférés történik a <tt>bltsize</tt> vagy a <tt>bltsizh</tt> regiszterekhez
és törölve ha olvasási hozzáférés törtenik a <tt>dmaconr</tt> regiszterhez.
Minden blitter regiszter írási mûveleténél a belsõ változó értéke ellenõrzésre
kerül, és ha az azt mutatja, hogy egy blitter feladat fut, akkor az installált
program ki fog lépni és a WHDLoad ki fogja írni az utolsó elindított blitter
mûvelet PC-jét az aktuális hozzáféréssel együtt.
<br>Két fõ hátulütõje van ennek a lehetõségnek. Elõször is a blitter használata
a copperen keresztül nincs ellenõrizve, másodszor a blitter megszakítások ok
nélküli hibákat generálhatnak az ellenõrzõ rutinoknál.
<h4>A jövõ</h4>
Tervbe vannak véve olyan funkciók, mint a Leállítás és Ikonizálás.
Ezekhez a Figyelés alapvetõ fontosságú. Ezért javasolt az installálók
készítõinek számára, hogy ellenõrizzék az installálóikat a Figyelés
funkcióival, a jövõbeni kompatibilitás érdekében.
<h4>Követelmények</h4>
Egy MMU szükséges a Figyelés funkcióhoz. A WHDLoad-nak <a
href="mmu.html#usercontrol">használnia</a> kell az MMU-t, ezért az <a
href="opt.html#MMU">MMU/S</a> opciót be kell kapcsolni minden 68030-as gépen.
<h4>Korlátozások</h4>
<ul>
<li>68020 + 68851
<ul>
<li>ez a hardver jelenleg nem támogatott
</ul>
<li>68030
<ul>
<li>nincsenek ismert korlátozások
</ul>
<li>68040
<ul>
<li>ez a hardver jelenleg nem támogatott
</ul>
<li>68060
<ul>
<li><tt>movem</tt> utasítás érvénytelen regiszterekhez férhet hozzá hozzáférési
hiba kivét létrehozása nélkül, ez azért lehetséges mert csak az elsõ hozzáférés
lesz ellenõrizve
<li><tt>move &lt;Cia/Egyéni regiszter&gt;,sr</tt> hibásan lesz végrehajtva, ha
megváltoztatja az állapotregiszter supervisor részét, a supervisor rész
változatlan marad
<li>bármilyen <tt>(ssp)+</tt> vagy <tt>-(ssp)</tt> együtt egy Cia vagy egyéni
regiszterhez tartozó írási hozzáféréssel nem kezelhetõ stackframe problémák
miatt, a WHDLoad érzékeli az ilyen hozzáféréseket és kilép a megfelelõ
kérdezõvel
<li>az utasítások nem férhetnek hozzá egynél több regiszterhez egy idõben,
ez azt jelenti, hogy az olyan kódok, mint a <tt>move.b ($dff006),($bfd800)</tt>
nem kezelhetõek, ha ilyen kódot talál a WHDLoad, egy hozzáférési hiba kérdezõt fog kirakni
</ul>
</ul>
</BODY>
</HTML>
