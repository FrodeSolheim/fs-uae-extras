<HTML>
<HEAD>
<TITLE>CPU Cache kezelés</TITLE>
<meta name="DC.Language" content="hu">
<meta http-equiv="content-language" content="hu">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2">
<!-- $Id: cache.html 1.6 2009/02/05 20:38:15 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>CPU Cache áttekintés</h3>
A teljesítmény növelése érdekében a 68k processzor-család képes a memóriahozzáférést
gyorsítótárazni.
<br>A cache mindig logikai címekhez van rendelve, beleértve a hozzáférés funkciókódját.
Ez azt jelenti, hogy a User Mode és a Supervisor Mode különbözõ cache bejegyzéseket
fognak generálni(a részletekért lásd a Motorola dokumentációját).
<p>Itt következik egy áttekintés a 68k processzorok cache-kezelésérõl:
<ul><li>68000
nincs
<li>68010<ul>
<li>Instruction Prefetch
<br>két word prefetch, egy word dekodoló regiszter
<li>Loop Mode
<br>akkor történeik, ha egy egy word hosszú utasítást egy DBcc követ, a ciklus végéig
nem történik több utasítás fetch a ciklus végéig.
</ul><li>68020<ul>
<li>Instruction Prefetch
<br>egy hosszú word
<li>Instruction Cache
<br>16 vonal &aacute; 16 byte = 256 byte
<br>kapcsolható be vagy álítható meg a CACR segítségével
</ul><li>68030<ul>
<li>Instruction Prefetch
<br>egy hosszú word
<li>Instruction Cache
<br>16 vonal &aacute; 16 byte = 256 byte
<br>kapcsolható be vagy álítható meg a CACR segítségével
<li>Data Cache
<br>16 vonal &aacute; 16 byte = 256 byte
<br>kapcsolható be vagy álítható meg a CACR segítségével
<br>WriteThrough mindig
<br>választható Write Allocation mód
</ul><li>68040<ul>
<li>Instruction Prefetch
<br>egy hosszú word
<li>Instruction Cache
<br>256 vonal &aacute; 16 byte = 4096 byte
<br>bekapcsolható a CACR segítségével
<li>Data Cache
<br>256 vonal &aacute; 16 byte = 4096 byte
<br>bekapcsolható a CACR segítségével
<br>választható CopyBack/WriteThrough módok az MMU segítségével
</ul><li>68060<ul>
<li>Instruction Prefetch
<br>egy hosszú word
<li>Instruction Cache
<br>512 vonal &aacute; 16 byte = 8192 byte
<br>bekapcsolható, leállítható és felére csökkenthetõ a CACR segítségével
<li>Branch Cache
<br>bekapcsolható a CACR segítségével
<br>nem érinti az MMU beállítást!
<li>Superscalar Dispatch
<br>bekapcsolható a CACR segítségével
<li>Data Cache
<br>512 vonal &aacute; 16 byte = 8192 byte
<br>bekapcsolható, leállítható és felére csökkenthetõ a CACR segítségével
<br>választható CopyBack/WriteThrough módok az MMU segítségével
<li>Push Buffer
<br>kikapcsolható a PCR segítségével
<li>Store Buffer
<br>bekapcsolható a CACR segítségével
<br>A lapok beállítása: NonCachable Serialized (precise)
</ul></ul>
<h4><a name="cache">A WHDLoad cache kezelése</a></h4>
Az elsõ fontos dolog az, hogy a 68030..68060 cache kezelését a Cache Control Register
(CACR) vezérli <b>és</b> az MMU (ha a WHDLoad használja és vezérli az MMU-t)!
<br>A CACR-ben a cache globálisan be vagy kikapcsolható. Az MMU single Page (4 KByte a
WHDLoad-dal) jelöli majd a cache típusát.
<br>A 68030-on a memorialap vagy Cacheable vagy NotCacheable. A 68040/68060-on lehet WriteThrough,
CopyBack, NonCachable (imprecise) vagy NonCachable Serialized (precise).
<p>Ha az MMU-t nem használja a WHDLoad, akkor csak a CACR vezérli.
<h4>Alapértelmezett cache beállítás</h4>
Alaphelyzetben a WHDLoad, a Slave és az ExpMem területe cacheable CopyBack módban van.
A BaseMem terület NonCachable, és a Data és az Instruction Cache be van kapcsolva a
CACR-ben. Így a BaseMem területen futó program cache nélkül fut, de a WHDLoad és a Slave
használja a cache-t a teljesítmény érdekében.
<h4>Programozók cache vezérlése</h4>
Két resload funkció vezérli a cache-t: <A
HREF="../autodoc.html#resload_SetCACR">resload_SetCACR</a> és <A
HREF="../autodoc.html#resload_SetCPU">resload_SetCPU</a>. A <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> a régi
rutin és teljesen lecserélhetõ a <a href="../autodoc.html#resload_SetCPU">resload_SetCPU</a> (a WHDLoad
belül átirányítja a <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> opcióit és meghívja a <a href="../autodoc.html#resload_SetCPU">resload_SetCPU</a>-t) által.
A <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> használata javasolt az olyan emberek számára, akik nem ismerik a cache
rendszert és az Amigában levõ változatát. A <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> használatával az instruction
és a data cache külön be vagy kikapcsolható. A <a href="../autodoc.html#resload_SetCACR">resload_SetCACR</a> csak a BaseMem
terület cache módjait állítja.
<h4>Felhasználó cache vezérlése</h4>
Ha a programozó jó munkát végzett, a felhasználónak nem kell semmit sem beállítania
a cache-el kapcsolatban, mivel a Slave mindent beállít.
<br>Két oka lehet a cache beállítás kézi beállításának. Elõször azért, hogy ha install
túl gyorsan fut (pl. grafikus hibákat generál) és másodszor azért, hogy az installált
program gyorsabban mûködjön.
<p>Egy lefagyó programot is mûködésre lehet bírni a <a
href="opt.html#NoCache">NoCache</a> opcióval. Ez az opció kikapcsolja az összes cache-t
és a memóriát NonCachable Serialized (precise) típusúnak állítja be.
Ha a gépnek van 32-bites Chip-memóriája, az még mindig gyorsabb mint az eredeti A500.
<p>Ha az installált programot gyorsítani szeretnéd, van néhány opció a cache
bekapcsolására. Ez felülírja a Slave beállításait. 68020-on a
<a href="opt.html#Cache">Cache</a> opció állítható be. 68030-on a <a
href="opt.html#DCache">DCache</a> opció is használható, amely magában foglalja a Cache
opciót is. 68060-on van még néhány egyéb opció: <a href="opt.html#BranchCache">BranchCache</a>,
<a href="opt.html#StoreBuffer">StoreBuffer</a> és
<a href="opt.html#SuperScalar">SuperScalar</a>. A <a
href="opt.html#ChipNoCache">ChipNoCache/S</a> opció növelheti a teljesítményt 68040-en és
68060-on, lásd késõbb.
<a name="chipmem"></a><h4>A Chip-memória cache vezérlése</h4>
A cache kezelését sem a CPU nem tudja beállítani (CACR), sem az MMU,
hanem egy külsõ hardver. A CPU tud jelezni a buszon, ha megpróbálja elérni a cache-t.
És a külsõ hardver tud jelezni a CPU-nak (miután a cím ki lett rakva a címbuszra
a memóriahozzáférés alatt) hogy a hozzáférést nem cache-elhetõ.
<br>Az a mechanizmus, ahogy a hardver jelez a CPU-nak hogy a memória cache-elhetõ vagy
nem, minden olyan AMigán és turbókártyán (SZVSZ) megtalálható, ahol a CPU >= 68030
(mert ezekben van adat cache). Az egész Chip-memória és az Space (Cia/Custom/RTC) nem
cache-elhetõ az adat cache által. Ez azért szükséges, hogy az inkonzisztenciákat
elkerüljük, például a DMA tevékenység miatt.
<br>A CPU válasza a nem cache-elhetõ hozzáférésre különbözik processzoronként.
68030-on nincs jelentõsége a teljesítményre, az adatok nincsenek cache-elve. 68040-en
az olvasási hozzáférések teljes sebességgel futnak, és az írási hozzáférések (CopyBack)
le lesznek állítva és újra lesznek indítva cache nélkül, ami ötször lassabb (függ a
hardvertõl és a CPU sebességétõl) lesz a nem cache-elt hozzáféréssel szemben. 68060-on
az olvasási és az írási hozzáférések le lesznek állítva és újra lesznek indítva.
Az olvasási hozzáférések háromszor lesznek lassabbak és az írási hozzáférések ötször.
<br>Az említett esetek az adat hozzáférésekre vonatkoznak. Az utasítás hozzáférések
általában nem érintettek és cache-elhetõk a Chip-memórián belül.
Van néhány (valószínûleg hibás) hardver, amely nem engedi az utasítások cache-elését
a Chip-memóriában. Az ilyen hardvereken a <a
href="opt.html#ChipNoCache">ChipNoCache/S</a> opciót használd a jelentõs lassulás
elkerülése végett, mert egyébként kb. fele sebességel fogank zajlani az utasítások.
<p>Ellenõrizheted a géped mûködését, ha futtatod a <i>Speed.Slave</i> programot, amely az
<tt>src/memory-speed</tt> könyvtárban található a fejlesztõi csomagban.
<h4>Write Allocation</h4>
A Write Allocation vezérli a 68030 cache kezelését, amikor cache kihagyás történik
egy írási mûveletnél. A Write Allocation-t be kell kapcsolni, ha az installált  program
User Mode-ban fut. Ha az installált program csak Supervisor Mode-ban fut, akkor a
Write Alloction kikapcsolható, ami ad egy minimális teljesítmény-növekedést.
<h4>Branch Cache</h4>
<p>A Branch Cache csak 68060-on érhetõ el. Ez egyfajta utasítás cache, az utasítások
összefogásával. De abban különbözik az utasitás cache-tõl, hogy független az MMU
beállítástól! Ez azt jelenti, hogy ha a megfelelõ memórialap nem cache-elhetõként van
jelölve, az összefogott utasítások akkor is cache-elve lesznek, ha a Branch Cache be van
kapcsolva.</p>
<hr>További információkért olvasd el a Motorola Microprocessors Felhasználói
Kézikönyvet.
Ha van javításod vagy egyéb információd ezzel az oldallal kapcsolatban, kérlek <A
HREF="mailto:wepl@whdload.de">írj</A> nekem.
</BODY>
</HTML>
